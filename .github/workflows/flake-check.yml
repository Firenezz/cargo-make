name: Flake Check
concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true
on: [push, pull_request]

jobs:
    flake-check:
        name: Flake Check
        runs-on: ${{ matrix.os }}
        permissions:
            contents: write
        strategy:
            fail-fast: false
            matrix:
                os: [ubuntu-latest]
        steps:
        - name: Checkout
          uses: actions/checkout@v4
      
        - name: Install Nix
          uses: cachix/install-nix-action@v26
          with: 
            nix_path: nixpkgs=channel:nixos-unstable
            
        - name: Install Nix Linting and Formatting Tools
          run: nix-env -i statix nixpkgs-fmt -f '<nixpkgs>'
        
        - name: Run Statix Lint
          run: statix fix
        
        - name: Run Nix Format
          run: nixpkgs-fmt .
        
        - name: Flake Check
          run: nix flake check